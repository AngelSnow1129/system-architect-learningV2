# 第1章：计算机硬件 - 知识提纲与重难点

## 📊 章节概况
- **考试重要性**：⭐⭐⭐
- **考试频率**：较低（19-21年未考，22年考过磁盘调度）
- **建议学习时间**：3-4小时
- **主要题型**：选择题、计算题

---

## 🎯 核心知识点框架

### 1. 计算机硬件组成
```
计算机五大部件
├── 运算器（ALU、寄存器）
├── 控制器（IR、PC、AR、ID）
├── 存储器（内存、外存）
├── 输入设备
└── 输出设备
```

### 2. 中央处理单元（CPU）

#### 2.1 CPU的功能
- 程序控制：控制程序执行顺序
- 操作控制：产生并发送操作信号
- 时间控制：控制操作信号的时序
- 数据处理：算术运算和逻辑运算
- 中断处理：响应系统内外部中断

#### 2.2 CPU的组成
**运算器组件：**
- ALU（算术逻辑单元）：执行算术和逻辑运算
- AC（累加寄存器）：存放运算结果或源操作数 ⭐
- DR（数据缓冲寄存器）：暂存内存的指令或数据
- PSW（状态条件寄存器）：保存运算结果的条件码

**控制器组件：**
- IR（指令寄存器）：暂存CPU执行的指令
- PC（程序计数器）：存放指令执行地址 ⭐
- AR（地址寄存器）：保存当前访问的内存地址
- ID（指令译码器）：分析指令操作码

---

### 3. 校验码 ⭐⭐

#### 3.1 基本概念
- **码距（汉明距离）**：两个编码间需改变的位数
- 码距越大，检错和纠错能力越强

#### 3.2 奇偶校验码
- **奇校验**：编码中含奇数个1
- **偶校验**：编码中含偶数个1
- **特点**：只能检测1位错误，无法纠错

#### 3.3 循环冗余校验码（CRC）⭐⭐⭐
**原理：**
- 在原始信息后追加校验位，使整体能被生成多项式整除
- 接收方用生成多项式除接收数据，余数为0则无错

**计算步骤：**
1. 生成多项式阶为r，在原始信息后加r个0
2. 用新串对生成多项式做模2除法（异或运算）
3. 将余数（不足r位前补0）拼接到原始信息后

**考试要点：**
- 掌握模2除法运算规则（异或，不进位不借位）
- 能根据生成多项式计算CRC编码

---

### 4. 指令系统 ⭐⭐⭐

#### 4.1 指令组成与执行
**指令组成：**
- 操作码：决定要完成的操作
- 操作数：参加运算的数据及地址

**执行过程：**
1. 取指令：PC → 地址总线 → 内存 → IR
2. 分析指令：指令译码器分析操作码
3. 执行指令：取源操作数，进行运算

#### 4.2 寻址方式
**指令寻址：**
- 顺序寻址：按顺序执行
- 跳跃寻址：由指令直接给出下一条地址

**操作数寻址：**
- 立即寻址：地址字段直接是操作数
- 直接寻址：地址字段指出操作数在主存的地址
- 间接寻址：地址字段指向存储操作数地址的单元
- 寄存器寻址：地址码是寄存器编号
- 基址寻址：基址寄存器内容 + 形式地址
- 变址寻址：变址寄存器内容 + 形式地址

#### 4.3 指令集类型（CISC vs RISC）⭐⭐⭐

| 特性 | CISC（复杂指令集） | RISC（精简指令集） |
|------|-------------------|-------------------|
| 指令数量 | 多，使用频率差别大 | 少，使用频率接近 |
| 指令格式 | 可变长 | 定长 |
| 寻址方式 | 支持多种 | 支持少 |
| 实现方式 | 微程序控制（微码） | 硬布线逻辑控制 |
| 寄存器 | 较少 | 大量通用寄存器 |
| 内存访问 | 多数指令可访问 | 仅Load/Store访问 |
| 流水线 | 不易实现 | 易实现，大部分单周期 |

#### 4.4 流水线技术 ⭐⭐⭐⭐

**基本概念：**
- 将指令执行分成多个阶段（取指、译码、执行等）
- 不同指令的不同阶段重叠执行

**RISC流水线技术：**
- **超流水线**：细化流水、增加级数、提高主频（以时间换空间）
- **超标量**：内置多条流水线同时执行（以空间换时间）
- **超长指令字（VLIW）**：编译器组合多条并行指令

**性能计算公式：** ⭐⭐⭐⭐⭐
- **流水线周期** = 执行时间最长的段
- **流水线执行时间** = 第1条指令执行时间 + (指令条数 - 1) × 流水线周期
- **吞吐率** = 指令条数 / 流水线执行时间
- **加速比** = 不使用流水线时间 / 使用流水线时间

---

### 5. 存储系统 ⭐⭐⭐⭐

#### 5.1 存储体系结构
**分级目的：**
- 解决容量、成本、速度之间的矛盾

**常见分级：**
- Cache - 主存
- 主存 - 辅存（虚拟存储）

#### 5.2 局部性原理
- **时间局部性**：最近访问的数据近期可能再次访问
- **空间局部性**：将要访问的数据地址与当前地址相近

#### 5.3 高速缓存（Cache）⭐⭐⭐⭐

**特点：**
- 位于CPU和主存之间
- 容量小、速度快（内存的5-10倍）
- 存储主存部分内容的副本
- 对程序员透明

**工作流程：**
- 命中：直接从Cache读取
- 未命中：从主存读取并替换Cache内容

#### 5.4 地址映射方式 ⭐⭐⭐

**直接映像：**
- 主存块与Cache块固定对应（取模）
- 优点：地址变换简单
- 缺点：不灵活，冲突概率高

**全相联映像：**
- 主存任意块可调入Cache任意位置
- 优点：冲突概率最低
- 缺点：地址变换复杂，速度慢

**组相联映像：**
- 组间直接映像，组内全相联
- 折中方案

**冲突概率排序：** 直接映像 > 组相联映像 > 全相联映像

#### 5.5 替换算法 ⭐⭐⭐
- **随机替换（RAND）**：随机选择
- **先进先出（FIFO）**：替换最先进入的块
- **近期最少使用（LRU）**：替换最少被访问的块
- **优化替换（OPT）**：替换未来最长时间不访问的块（理想）

#### 5.6 性能指标 ⭐⭐⭐⭐
**命中率（H）：** CPU访问数据在Cache中的比率

**平均访问时间（Ta）：**
```
Ta = H × T_cache + (1 - H) × T_memory
```

---

### 6. 磁盘存储 ⭐⭐⭐

#### 6.1 磁盘结构
- 盘面 → 磁道（同心圆）→ 扇区

#### 6.2 存取时间
```
存取时间 = 寻道时间 + 等待时间（旋转延迟）
```

#### 6.3 磁盘调度算法 ⭐⭐⭐⭐

**先来先服务（FCFS）：**
- 按请求顺序调度
- 公平但效率不高

**最短寻道时间优先（SSTF）：**
- 优先调度距离最近的请求
- 可能导致"饥饿"现象

**扫描算法（SCAN/电梯算法）：**
- 磁头双向移动
- 选择移动方向上最近的请求
- 到达一端后掉头

**单向扫描（C-SCAN）：**
- 只做单向移动
- 到达一端后立即返回起始端

#### 6.4 磁盘优化分布 ⭐⭐⭐
**问题：** 顺序存放时，处理一个记录后磁头已转过，需等待一圈

**解决：** 间隔存放，使处理时间内磁头刚好转到下一记录

---

### 7. 输入/输出技术 ⭐⭐

#### 7.1 I/O地址编址
- **独立编址**：I/O地址空间与内存分开，使用专门I/O指令
- **统一编址**：I/O和内存共用地址空间，功能强但占用内存空间

#### 7.2 I/O控制方式 ⭐⭐⭐

**程序控制（查询）方式：**
- CPU主动循环查询
- 效率极低

**程序中断方式：**
- 外设发送中断请求
- CPU响应中断处理
- 效率较高
- **响应时机**：一条指令执行结束后

**DMA方式（直接内存存取）：**
- DMA控制器完成数据传输
- 主存和外设间建立直接通路
- 不占用CPU时间，效率最高
- **响应时机**：一个总线周期结束后 ⭐

---

### 8. 总线结构 ⭐⭐

#### 8.1 总线分类

**内部总线：**
- 芯片级，芯片与处理器通信

**系统总线：**
- 板级总线
- 数据总线：决定并行传输位数
- 地址总线：决定内存空间大小
- 控制总线：传送控制命令
- 代表：ISA、PCI

**外部总线：**
- 设备级，微机与外设连接
- 代表：RS232（串行）、SCSI（并行）、USB（通用串行）

#### 8.2 总线特点
- **串行总线**：适合长距离传输
- **并行总线**：适合近距离高速传输，但线间串扰限制速率
- **单总线结构**：设计简单，但易成为性能瓶颈
- **半双工**：可双向传输，但不能同时进行

---

## 🔥 重难点分析

### 重点1：CRC循环冗余校验码计算 ⭐⭐⭐⭐⭐
**难度**：★★★★☆
**考试频率**：高

**核心原理：** ⭐⭐⭐⭐⭐
在原始信息后追加校验位，使整体能被生成多项式整除。

**模2除法运算规则：** ⭐⭐⭐⭐⭐
- 实质是异或运算（XOR）
- 不进位、不借位
- 0 ⊕ 0 = 0
- 0 ⊕ 1 = 1
- 1 ⊕ 0 = 1
- 1 ⊕ 1 = 0

**详细计算步骤：** ⭐⭐⭐⭐⭐

**步骤1：确定生成多项式的阶数r**
- 生成多项式 G(x) = x⁴ + x + 1
- 对应二进制：10011
- 阶数 r = 4（最高次幂）

**步骤2：在原始信息后添加r个0**
- 原始信息：1100
- 添加4个0：11000000

**步骤3：进行模2除法**
```
被除数：11000000
除数：  10011

        1101      ← 商（不需要）
      --------
10011 | 11000000
        10011     ← 第1次异或
        -----
         10110    
         10011    ← 第2次异或
         -----
           1010
           1001    ← 第3次异或（补0对齐）
           ----
            0111
            0000   ← 第4次异或（补0对齐）
            ----
             1110
             1001  ← 第5次异或（补0对齐）
             ----
              1110
              1001 ← 第6次异或（补0对齐）
              ----
               111 ← 余数不足4位，前补0
```

**步骤4：得到余数并拼接**
- 余数：0111（4位）
- CRC编码 = 原始信息 + 余数
- CRC编码 = 1100 + 0111 = 11000111

**快速计算技巧：** ⭐⭐⭐⭐⭐

**技巧1：对齐规则**
- 除数的最高位1对齐被除数的最高位1
- 进行异或运算

**技巧2：判断是否需要异或**
- 看被除数当前最高位
- 如果是1，则进行异或
- 如果是0，则直接下移（相当于异或全0）

**技巧3：余数位数**
- 余数必须是r位
- 不足r位时前面补0

**典型例题：** ⭐⭐⭐⭐⭐

**例题：** 数据信息为1100，生成多项式为X³+X+1（即1011），求CRC编码。

**解答：**
1. 生成多项式1011，阶数r=3
2. 原始信息1100后加3个0：1100000
3. 模2除法：
```
      1111
    --------
1011| 1100000
      1011
      ----
       1110
       1011
       ----
        1010
        1011
        ----
         0010  ← 余数（3位：010）
```
4. CRC编码 = 1100 + 010 = 1100010

**答案：1100010**

**易错点提醒：** ⭐⭐⭐⭐⭐
1. 模2除法是异或运算，不是普通除法
2. 生成多项式的阶数决定补0的个数
3. 余数位数必须等于阶数r
4. 余数不足r位时前面补0
5. 最终CRC编码 = 原始信息 + 余数（不是被除数）

### 重点2：流水线性能计算 ⭐⭐⭐⭐⭐
**难度**：★★★★☆
**考试频率**：极高

**核心公式：** ⭐⭐⭐⭐⭐

**公式1：流水线周期**
```
流水线周期 = max(各段执行时间)
即：执行时间最长的那一段
```

**公式2：流水线执行时间**
```
总执行时间 = 第1条指令执行时间 + (指令条数 - 1) × 流水线周期
           = Σ(各段时间) + (n - 1) × 流水线周期
```

**公式3：流水线吞吐率**
```
吞吐率 = 指令条数 / 流水线执行时间
单位：个/s 或 MIPS
```

**公式4：流水线加速比**
```
加速比 = 不使用流水线的执行时间 / 使用流水线的执行时间
       = (n × Σ各段时间) / [Σ各段时间 + (n-1) × 流水线周期]
```

**公式5：最大加速比（n→∞）**
```
最大加速比 = Σ各段时间 / 流水线周期
           = 各段时间之和 / 最长段时间
```

**详细解题步骤：** ⭐⭐⭐⭐⭐

**例题1：** 某流水线有5段，各段时间分别为2ns、1ns、1ns、1ns、1ns，执行100条指令，求吞吐率。

**步骤1：确定流水线周期**
```
流水线周期 = max(2, 1, 1, 1, 1) = 2ns
```

**步骤2：计算第1条指令执行时间**
```
第1条指令时间 = 2 + 1 + 1 + 1 + 1 = 6ns
```

**步骤3：计算总执行时间**
```
总时间 = 6ns + (100 - 1) × 2ns
       = 6ns + 99 × 2ns
       = 6ns + 198ns
       = 204ns
```

**步骤4：计算吞吐率**
```
吞吐率 = 100 / 204ns
       = 100 / (204 × 10⁻⁹) s
       = (100 / 204) × 10⁹ 个/s
       ≈ 0.490 × 10⁹ 个/s
       = 490 × 10⁶ 个/s
```

**答案：490 × 10⁶ 个/s**

**例题2：** 某流水线5段，时间为6ns、7ns、8ns、9ns、6ns，求最大加速比。

**步骤1：计算各段时间之和**
```
Σ各段时间 = 6 + 7 + 8 + 9 + 6 = 36ns
```

**步骤2：确定流水线周期**
```
流水线周期 = max(6, 7, 8, 9, 6) = 9ns
```

**步骤3：计算不使用流水线时间（n条指令）**
```
不使用流水线 = n × 36ns
```

**步骤4：计算使用流水线时间（n条指令）**
```
使用流水线 = 36 + (n-1) × 9 = 36 + 9n - 9 = 27 + 9n
```

**步骤5：计算加速比**
```
加速比 = 36n / (27 + 9n)
```

**步骤6：求最大加速比（n→∞）**
```
当n→∞时：
加速比 = 36n / 9n = 36 / 9 = 4
```

**或直接用公式：**
```
最大加速比 = 36 / 9 = 4
```

**答案：4**

**单位换算表：** ⭐⭐⭐⭐⭐
```
1秒(s) = 10³ 毫秒(ms)
1秒(s) = 10⁶ 微秒(μs)
1秒(s) = 10⁹ 纳秒(ns)
1秒(s) = 10¹² 皮秒(ps)
```

**快速记忆法：** ⭐⭐⭐⭐⭐
- "周期取最长" - 流水线周期是最长段
- "首条全相加" - 第1条指令时间是所有段之和
- "后续乘周期" - 后续指令每条需一个周期
- "吞吐除总时" - 吞吐率 = 指令数 / 总时间
- "加速比时间" - 加速比 = 不用流水线时间 / 用流水线时间
- "最大除周期" - 最大加速比 = 总时间 / 周期

**易错点提醒：** ⭐⭐⭐⭐⭐
1. 流水线周期是最长段，不是所有段之和
2. 第1条指令需要走完所有段
3. 后续每条指令只需要一个流水线周期
4. 单位换算要注意：1s = 10⁹ns
5. 加速比的分子是不使用流水线的时间
6. 最大加速比在n趋向无穷大时取得
7. 吞吐率单位要正确转换

### 重点3：Cache地址映射与性能 ⭐⭐⭐⭐
**难度**：★★★☆☆
**考试频率**：中
**掌握要求**：
- 理解三种映射方式的区别
- 掌握冲突概率排序
- 能计算命中率和平均访问时间

### 重点4：磁盘调度算法 ⭐⭐⭐⭐
**难度**：★★★☆☆
**考试频率**：中
**掌握要求**：
- 理解各算法原理
- 能根据请求序列模拟调度过程
- 掌握磁盘优化分布计算

### 重点5：CPU组成与寄存器功能 ⭐⭐⭐
**难度**：★★☆☆☆
**考试频率**：中
**掌握要求**：
- 记住各寄存器的功能
- 重点：AC存放运算结果，PC存放指令地址

### 重点6：CISC vs RISC ⭐⭐⭐
**难度**：★★☆☆☆
**考试频率**：中
**掌握要求**：
- 记住两者的主要区别
- 理解各自的优缺点

### 重点7：I/O控制方式 ⭐⭐⭐
**难度**：★★☆☆☆
**考试频率**：低
**掌握要求**：
- 理解三种方式的效率差异
- 记住DMA和中断的响应时机区别

---

## 📝 学习建议

### 学习顺序
1. CPU组成与功能（基础）
2. 指令系统与流水线（重点）
3. 存储系统与Cache（重点）
4. 校验码计算（重点）
5. 磁盘调度（次重点）
6. I/O与总线（了解）

### 复习策略
1. **必须掌握**：CRC计算、流水线计算、Cache性能计算
2. **重点理解**：CISC vs RISC、磁盘调度算法
3. **记忆为主**：CPU寄存器功能、总线分类

### 易错点提醒
1. CRC计算时注意模2除法规则（异或运算）
2. 流水线周期是最长段，不是所有段之和
3. Cache冲突概率：直接映像最高，全相联最低
4. DMA响应在总线周期后，中断响应在指令执行后
5. 磁盘优化分布要考虑处理时间内磁头转过的扇区数

---

## 🎯 考试题型分布

| 题型 | 考点 | 分值 | 难度 |
|------|------|------|------|
| 选择题 | CPU寄存器功能 | 1-2分 | ★☆☆ |
| 选择题 | CISC vs RISC | 1-2分 | ★★☆ |
| 选择题 | Cache映射方式 | 1-2分 | ★★☆ |
| 计算题 | CRC编码计算 | 2-3分 | ★★★★ |
| 计算题 | 流水线性能 | 2-3分 | ★★★★ |
| 计算题 | Cache命中率 | 2-3分 | ★★★ |
| 综合题 | 磁盘调度 | 3-4分 | ★★★ |

---

## 💡 记忆口诀

**CPU五大功能：**
"程操时数中" - 程序控制、操作控制、时间控制、数据处理、中断处理

**运算器四大件：**
"ALU算，AC存，DR缓，PSW状态"

**控制器四大件：**
"IR存指令，PC存地址，AR访内存，ID译码"

**Cache映射冲突：**
"直接最高，全联最低，组联居中"

**磁盘调度算法：**
"先来先服务，最短寻道优，扫描像电梯，单向不回头"

---

## ⏰ 预计学习时间分配

- CPU与指令系统：1小时
- 校验码：0.5小时
- 流水线技术：1小时（含练习）
- 存储系统与Cache：1小时
- 磁盘调度：0.5小时（含练习）
- I/O与总线：0.5小时
- 总复习与习题：1小时

**总计：约5-6小时**
