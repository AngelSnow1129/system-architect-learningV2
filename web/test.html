<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç³»ç»Ÿæµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', sans-serif;
            padding: 20px;
            background: #f5f7fa;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #667eea;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
        }
        .test-item {
            margin: 10px 0;
            padding: 10px;
            background: white;
            border-left: 3px solid #ddd;
        }
        .success {
            border-left-color: #43e97b;
        }
        .error {
            border-left-color: #f5576c;
        }
        .warning {
            border-left-color: #ffd700;
        }
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #764ba2;
        }
        #results {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ ç³»ç»Ÿæ¶æ„è®¾è®¡å¸ˆå­¦ä¹ å¹³å° - ç³»ç»Ÿæµ‹è¯•</h1>
        
        <div class="test-section">
            <h2>æµ‹è¯•æ§åˆ¶</h2>
            <button onclick="testAll()">è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
            <button onclick="testConfig()">æµ‹è¯•é…ç½®æ–‡ä»¶</button>
            <button onclick="testFiles()">æµ‹è¯•æ–‡ä»¶å­˜åœ¨æ€§</button>
            <button onclick="clearResults()">æ¸…é™¤ç»“æœ</button>
        </div>

        <div id="results"></div>
    </div>

    <script src="config.js"></script>
    <script>
        const resultsDiv = document.getElementById('results');

        function clearResults() {
            resultsDiv.innerHTML = '';
        }

        function addResult(title, message, status = 'success') {
            const div = document.createElement('div');
            div.className = `test-item ${status}`;
            div.innerHTML = `<strong>${title}</strong><br>${message}`;
            resultsDiv.appendChild(div);
        }

        function addSection(title) {
            const div = document.createElement('div');
            div.className = 'test-section';
            div.innerHTML = `<h2>${title}</h2>`;
            resultsDiv.appendChild(div);
            return div;
        }

        async function testConfig() {
            clearResults();
            addSection('ğŸ“‹ é…ç½®æ–‡ä»¶æµ‹è¯•');

            try {
                if (typeof CONFIG === 'undefined') {
                    addResult('é…ç½®æ–‡ä»¶', 'âŒ CONFIGæœªå®šä¹‰', 'error');
                    return;
                }

                addResult('é…ç½®æ–‡ä»¶', 'âœ… CONFIGå·²åŠ è½½', 'success');

                // æµ‹è¯•è€ƒè¯•ç±»å‹
                const examTypes = Object.keys(CONFIG.examTypes);
                addResult('è€ƒè¯•ç±»å‹', `âœ… æ‰¾åˆ° ${examTypes.length} ä¸ªè€ƒè¯•ç±»å‹: ${examTypes.join(', ')}`, 'success');

                // æµ‹è¯•ç« èŠ‚æ•°é‡
                const architect = CONFIG.examTypes.architect;
                if (architect) {
                    addResult('ç³»ç»Ÿæ¶æ„è®¾è®¡å¸ˆç« èŠ‚', `âœ… å…± ${architect.chapters.length} ä¸ªç« èŠ‚`, 'success');

                    // ç»Ÿè®¡å„ç±»å‹ç« èŠ‚
                    const withKeypoint = architect.chapters.filter(c => c.hasKeypoint).length;
                    const withMustKnow = architect.chapters.filter(c => c.hasMustKnow).length;
                    addResult('é‡ç‚¹æçº²', `âœ… ${withKeypoint} ä¸ªç« èŠ‚æœ‰é‡ç‚¹æçº²`, 'success');
                    addResult('å¿…èƒŒå†…å®¹', `âœ… ${withMustKnow} ä¸ªç« èŠ‚æœ‰å¿…èƒŒå†…å®¹`, 'success');
                }

                // æµ‹è¯•è§†å›¾ç±»å‹
                const viewTypes = Object.keys(CONFIG.viewTypes);
                addResult('è§†å›¾ç±»å‹', `âœ… æ‰¾åˆ° ${viewTypes.length} ä¸ªè§†å›¾ç±»å‹: ${viewTypes.join(', ')}`, 'success');

            } catch (error) {
                addResult('é…ç½®æµ‹è¯•', `âŒ é”™è¯¯: ${error.message}`, 'error');
            }
        }

        async function testFiles() {
            clearResults();
            addSection('ğŸ“ æ–‡ä»¶å­˜åœ¨æ€§æµ‹è¯•');

            const architect = CONFIG.examTypes.architect;
            let totalTests = 0;
            let passedTests = 0;
            let failedTests = 0;

            for (const chapter of architect.chapters) {
                // æµ‹è¯•å®Œæ•´ç« èŠ‚æ–‡ä»¶
                totalTests++;
                const normalPath = `${chapter.id}_${chapter.name}.md`;
                try {
                    const response = await fetch(normalPath, { method: 'HEAD' });
                    if (response.ok) {
                        addResult(`ç« èŠ‚ ${chapter.id}`, `âœ… ${normalPath}`, 'success');
                        passedTests++;
                    } else {
                        addResult(`ç« èŠ‚ ${chapter.id}`, `âš ï¸ ${normalPath} (${response.status})`, 'warning');
                        failedTests++;
                    }
                } catch (error) {
                    addResult(`ç« èŠ‚ ${chapter.id}`, `âŒ ${normalPath} - ${error.message}`, 'error');
                    failedTests++;
                }

                // æµ‹è¯•é‡ç‚¹æçº²
                if (chapter.hasKeypoint) {
                    totalTests++;
                    const name = chapter.altName || chapter.name;
                    const keypointPath = `keypoint/${chapter.id}_${name}_çŸ¥è¯†æçº².md`;
                    try {
                        const response = await fetch(keypointPath, { method: 'HEAD' });
                        if (response.ok) {
                            addResult(`é‡ç‚¹æçº² ${chapter.id}`, `âœ… ${keypointPath}`, 'success');
                            passedTests++;
                        } else {
                            addResult(`é‡ç‚¹æçº² ${chapter.id}`, `âŒ ${keypointPath} (${response.status})`, 'error');
                            failedTests++;
                        }
                    } catch (error) {
                        addResult(`é‡ç‚¹æçº² ${chapter.id}`, `âŒ ${keypointPath} - ${error.message}`, 'error');
                        failedTests++;
                    }
                }

                // æµ‹è¯•å¿…èƒŒå†…å®¹
                if (chapter.hasMustKnow) {
                    totalTests++;
                    const name = chapter.altName || chapter.name;
                    const mustKnowPath = `keypoint/${chapter.id}_${name}_å¿…èƒŒè¡¥å…….md`;
                    try {
                        const response = await fetch(mustKnowPath, { method: 'HEAD' });
                        if (response.ok) {
                            addResult(`å¿…èƒŒå†…å®¹ ${chapter.id}`, `âœ… ${mustKnowPath}`, 'success');
                            passedTests++;
                        } else {
                            addResult(`å¿…èƒŒå†…å®¹ ${chapter.id}`, `âŒ ${mustKnowPath} (${response.status})`, 'error');
                            failedTests++;
                        }
                    } catch (error) {
                        addResult(`å¿…èƒŒå†…å®¹ ${chapter.id}`, `âŒ ${mustKnowPath} - ${error.message}`, 'error');
                        failedTests++;
                    }
                }
            }

            // æ˜¾ç¤ºæ€»ç»“
            addSection('ğŸ“Š æµ‹è¯•æ€»ç»“');
            addResult('æ€»è®¡', `å…±æµ‹è¯• ${totalTests} ä¸ªæ–‡ä»¶`, 'success');
            addResult('é€šè¿‡', `âœ… ${passedTests} ä¸ªæ–‡ä»¶`, 'success');
            if (failedTests > 0) {
                addResult('å¤±è´¥', `âŒ ${failedTests} ä¸ªæ–‡ä»¶`, 'error');
            }
            const successRate = ((passedTests / totalTests) * 100).toFixed(1);
            addResult('æˆåŠŸç‡', `${successRate}%`, successRate >= 80 ? 'success' : 'warning');
        }

        async function testAll() {
            await testConfig();
            await new Promise(resolve => setTimeout(resolve, 1000));
            await testFiles();
        }

        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºæ¬¢è¿ä¿¡æ¯
        window.onload = function() {
            addSection('ğŸ‘‹ æ¬¢è¿');
            addResult('ç³»ç»Ÿæµ‹è¯•', 'ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•', 'success');
        };
    </script>
</body>
</html>
