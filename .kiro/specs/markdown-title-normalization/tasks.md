# Implementation Plan

- [x] 1. 创建项目结构和核心数据模型


  - 创建Python脚本文件 `normalize_titles.py`
  - 定义 `TitleInfo` 数据类，包含行号、原始文本、当前层级、期望层级等属性
  - 定义标题层级判断的正则表达式模式
  - _Requirements: 1.1, 2.1, 2.2, 2.3, 2.4, 2.5_



- [ ] 2. 实现文件读取和备份功能
  - 实现 `read_file()` 函数读取Markdown文件内容
  - 实现 `backup_file()` 函数创建文件备份（添加.backup扩展名）
  - 实现 `write_file()` 函数保存修改后的内容


  - 添加文件编码检测和处理（支持UTF-8）
  - _Requirements: 3.2, 3.3, 5.2_

- [ ] 3. 实现标题分析功能
  - 实现 `extract_titles()` 函数提取所有标题行


  - 实现 `determine_title_level()` 函数根据标题内容判断正确层级
  - 实现 `analyze_title()` 函数检测单个标题的问题
  - 实现 `generate_analysis_report()` 函数生成分析报告
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 2.1, 2.2, 2.3, 2.4, 2.5_



- [ ] 4. 实现标题修正功能
  - 实现 `fix_title_format()` 函数修正单个标题格式
  - 确保#符号后有且仅有一个空格
  - 根据期望层级生成正确数量的#符号
  - 保持标题文本内容完全不变


  - _Requirements: 4.1, 4.2, 4.3_

- [ ] 5. 实现批次处理功能
  - 实现 `divide_into_batches()` 函数按章节划分批次
  - 实现 `process_batch()` 函数处理单个批次


  - 实现批次进度显示功能
  - 每个批次处理后保存文件
  - _Requirements: 3.1, 3.2, 3.3, 3.4_

- [x] 6. 实现结果验证功能


  - 实现 `validate_modifications()` 函数验证修改结果
  - 实现 `compare_versions()` 函数对比修改前后的差异
  - 实现 `count_changes()` 函数统计修改数量
  - 生成修改前后的对比报告
  - _Requirements: 5.1, 5.2, 5.3, 5.4_


- [ ] 7. 实现主控制流程
  - 实现 `main()` 函数协调整个处理流程
  - 添加命令行参数支持（文件路径、批次模式等）
  - 实现用户交互确认机制
  - 添加错误处理和日志记录

  - _Requirements: 3.3, 3.4_

- [ ] 8. 执行第一批次：分析和报告
  - 运行脚本分析 `00_系统架构设计师第二版.md` 文件
  - 生成完整的标题问题分析报告
  - 显示需要修正的标题数量和类型

  - 等待用户确认是否继续
  - _Requirements: 1.4, 3.3_

- [ ] 9. 执行第二批次：修正前言和目录部分
  - 处理文件开头到第1章之前的内容
  - 修正"内容简介"、"前言"、"目录"、"上篇"等标题

  - 保存修改并生成该批次的修改报告
  - 验证修改结果
  - _Requirements: 3.2, 3.3, 4.1, 4.2, 4.3, 4.4_

- [ ] 10. 执行第三批次：修正第1-5章
  - 处理第1章到第5章的所有标题


  - 应用标题层级修正规则
  - 保存修改并生成该批次的修改报告
  - 验证修改结果
  - _Requirements: 3.2, 3.3, 4.1, 4.2, 4.3, 4.4_

- [ ] 11. 执行第四批次：修正第6-11章
  - 处理第6章到第11章的所有标题
  - 应用标题层级修正规则
  - 保存修改并生成该批次的修改报告
  - 验证修改结果
  - _Requirements: 3.2, 3.3, 4.1, 4.2, 4.3, 4.4_

- [ ] 12. 执行第五批次：修正下篇（第12-20章）
  - 处理"下篇"标题及第12章到第20章的所有标题
  - 应用标题层级修正规则
  - 保存修改并生成该批次的修改报告
  - 验证修改结果
  - _Requirements: 3.2, 3.3, 4.1, 4.2, 4.3, 4.4_

- [ ] 13. 生成最终验证报告
  - 对整个文件进行完整性验证
  - 统计总共修改的标题数量
  - 验证所有标题层级是否符合规范
  - 生成修改前后的完整对比报告
  - 确认非标题内容未被修改
  - _Requirements: 5.1, 5.2, 5.3, 5.4_
